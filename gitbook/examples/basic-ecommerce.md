# –ë–∞–∑–æ–≤–æ–µ E-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è e-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å Flutter Magento Plugin 2.0. –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –∫–æ—Ä–∑–∏–Ω—É, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤.

## üéØ –ß—Ç–æ –º—ã —Å–æ–∑–¥–∞–¥–∏–º

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ —Å:

- üè† **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- üõçÔ∏è **–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- üîç **–ü–æ–∏—Å–∫** —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- üõí **–ö–æ—Ä–∑–∏–Ω–∞** —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- üë§ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìã **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤**
- ‚ù§Ô∏è **–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π**
- ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üì± –°–∫—Ä–∏–Ω—à–æ—Ç—ã –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
[–ì–ª–∞–≤–Ω–∞—è]     [–ö–∞—Ç–∞–ª–æ–≥]     [–ü—Ä–æ–¥—É–∫—Ç]     [–ö–æ—Ä–∑–∏–Ω–∞]
   üè†            üì±            üõçÔ∏è           üõí
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
lib/
‚îú‚îÄ‚îÄ main.dart                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ app.dart             # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ routes.dart          # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ constants/           # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ themes/             # –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ models/             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ repositories/       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ services/           # –°–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ presentation/
‚îÇ   ‚îú‚îÄ‚îÄ providers/          # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ screens/            # –≠–∫—Ä–∞–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ widgets/            # –í–∏–¥–∂–µ—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ components/         # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ env.dart            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```yaml
name: magento_shop
description: Complete e-commerce app with Flutter Magento Plugin 2.0

dependencies:
  flutter:
    sdk: flutter
  
  # Magento Integration
  flutter_magento: ^2.8.0
  
  # State Management
  provider: ^6.1.1
  riverpod: ^3.0.0
  
  # UI Components
  cached_network_image: ^3.3.1
  flutter_svg: ^2.0.9
  shimmer: ^3.0.0
  pull_to_refresh: ^2.0.0
  
  # Navigation
  go_router: ^12.1.3
  
  # Network & Storage
  dio: ^5.4.0
  shared_preferences: ^2.2.2
  flutter_secure_storage: ^9.2.2
  
  # Utils
  intl: ^0.20.2
  flutter_dotenv: ^5.1.0
  connectivity_plus: ^7.0.0
  
  # Image & Media
  image_picker: ^1.0.4
  photo_view: ^0.14.0
  
  # Forms & Validation
  flutter_form_builder: ^9.1.1
  form_builder_validators: ^9.1.0

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^4.0.0
  mockito: ^5.4.4
  build_runner: ^2.6.0
```

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
flutter create magento_shop
cd magento_shop
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
# Magento Configuration
MAGENTO_BASE_URL=https://your-magento-store.com
MAGENTO_STORE_CODE=default
MAGENTO_CONSUMER_KEY=your_consumer_key
MAGENTO_CONSUMER_SECRET=your_consumer_secret

# App Configuration
APP_NAME=Magento Shop
APP_VERSION=1.0.0
DEBUG_MODE=true

# Features
ENABLE_SOCIAL_LOGIN=true
ENABLE_PUSH_NOTIFICATIONS=true
ENABLE_OFFLINE_MODE=true
```

### 3. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```dart
// lib/main.dart
import 'package:flutter/material.dart';
import 'package:flutter_dotenv/flutter_dotenv.dart';
import 'package:provider/provider.dart';
import 'app/app.dart';
import 'core/services/magento_service.dart';
import 'presentation/providers/providers.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  await dotenv.load(fileName: ".env");
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Magento
  await MagentoService.initialize();
  
  runApp(
    MultiProvider(
      providers: AppProviders.providers,
      child: const MagentoShopApp(),
    ),
  );
}
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```dart
// lib/app/app.dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:provider/provider.dart';
import '../core/themes/app_theme.dart';
import '../presentation/providers/theme_provider.dart';
import 'routes.dart';

class MagentoShopApp extends StatelessWidget {
  const MagentoShopApp({super.key});

  @override
  Widget build(BuildContext context) {
    return Consumer<ThemeProvider>(
      builder: (context, themeProvider, child) {
        return MaterialApp.router(
          title: 'Magento Shop',
          debugShowCheckedModeBanner: false,
          
          // –¢–µ–º—ã
          theme: AppTheme.lightTheme,
          darkTheme: AppTheme.darkTheme,
          themeMode: themeProvider.themeMode,
          
          // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
          supportedLocales: const [
            Locale('en', 'US'),
            Locale('ru', 'RU'),
            Locale('de', 'DE'),
            Locale('fr', 'FR'),
          ],
          
          // –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
          routerConfig: AppRoutes.router,
        );
      },
    );
  }
}
```

## üé® –î–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º–∞

### –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞

```dart
// lib/core/themes/app_colors.dart
class AppColors {
  // Primary Colors
  static const Color primary = Color(0xFF2196F3);
  static const Color primaryDark = Color(0xFF1976D2);
  static const Color primaryLight = Color(0xFFBBDEFB);
  
  // Secondary Colors
  static const Color secondary = Color(0xFFFF9800);
  static const Color secondaryDark = Color(0xFFE65100);
  static const Color secondaryLight = Color(0xFFFFE0B2);
  
  // Status Colors
  static const Color success = Color(0xFF4CAF50);
  static const Color warning = Color(0xFFFF9800);
  static const Color error = Color(0xFFE53E3E);
  static const Color info = Color(0xFF2196F3);
  
  // Neutral Colors
  static const Color background = Color(0xFFFAFAFA);
  static const Color surface = Color(0xFFFFFFFF);
  static const Color onSurface = Color(0xFF212121);
  static const Color onBackground = Color(0xFF424242);
  
  // Text Colors
  static const Color textPrimary = Color(0xFF212121);
  static const Color textSecondary = Color(0xFF757575);
  static const Color textHint = Color(0xFFBDBDBD);
}
```

### –¢–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```dart
// lib/core/themes/app_theme.dart
class AppTheme {
  static ThemeData get lightTheme {
    return ThemeData(
      useMaterial3: true,
      colorScheme: ColorScheme.fromSeed(
        seedColor: AppColors.primary,
        brightness: Brightness.light,
      ),
      
      // App Bar
      appBarTheme: const AppBarTheme(
        backgroundColor: AppColors.primary,
        foregroundColor: Colors.white,
        elevation: 0,
        centerTitle: true,
      ),
      
      // Elevated Button
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ElevatedButton.styleFrom(
          backgroundColor: AppColors.primary,
          foregroundColor: Colors.white,
          padding: const EdgeInsets.symmetric(
            horizontal: 24,
            vertical: 12,
          ),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(8),
          ),
        ),
      ),
      
      // Card
      cardTheme: CardTheme(
        elevation: 2,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12),
        ),
        margin: const EdgeInsets.all(8),
      ),
      
      // Input Decoration
      inputDecorationTheme: InputDecorationTheme(
        border: OutlineInputBorder(
          borderRadius: BorderRadius.circular(8),
        ),
        filled: true,
        fillColor: Colors.grey[50],
      ),
    );
  }
  
  static ThemeData get darkTheme {
    return ThemeData(
      useMaterial3: true,
      colorScheme: ColorScheme.fromSeed(
        seedColor: AppColors.primary,
        brightness: Brightness.dark,
      ),
      // ... —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞
    );
  }
}
```

## üîß –°–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### Magento —Å–µ—Ä–≤–∏—Å

```dart
// lib/core/services/magento_service.dart
import 'package:flutter_magento/flutter_magento.dart';
import 'package:flutter_dotenv/flutter_dotenv.dart';

class MagentoService {
  static final FlutterMagento _instance = FlutterMagento();
  
  static FlutterMagento get instance => _instance;
  
  static Future<bool> initialize() async {
    try {
      return await _instance.initialize(
        baseUrl: dotenv.env['MAGENTO_BASE_URL']!,
        headers: {
          'Store': dotenv.env['MAGENTO_STORE_CODE'] ?? 'default',
          'Content-Type': 'application/json',
        },
        connectionTimeout: 30000,
        receiveTimeout: 30000,
        enableDebugLogging: dotenv.env['DEBUG_MODE'] == 'true',
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—ç—à–∞
        cacheConfig: CacheConfig(
          enableCaching: true,
          cacheDuration: const Duration(minutes: 30),
          maxCacheSize: 100 * 1024 * 1024, // 100MB
        ),
        
        // –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
        offlineConfig: OfflineConfig(
          enableOfflineMode: dotenv.env['ENABLE_OFFLINE_MODE'] == 'true',
          syncInterval: const Duration(minutes: 15),
          maxOfflineActions: 100,
        ),
      );
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Magento: $e');
      return false;
    }
  }
}
```

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```dart
// lib/data/repositories/product_repository.dart
import 'package:flutter_magento/flutter_magento.dart';
import '../models/product_list_model.dart';
import '../../core/services/magento_service.dart';

class ProductRepository {
  final FlutterMagento _magento = MagentoService.instance;
  
  Future<ProductListModel> getProducts({
    int page = 1,
    int pageSize = 20,
    String? categoryId,
    String? searchQuery,
    Map<String, dynamic>? filters,
    String? sortBy,
    String? sortOrder,
  }) async {
    try {
      final response = await _magento.products.getProducts(
        page: page,
        pageSize: pageSize,
        categoryId: categoryId,
        searchQuery: searchQuery,
        filters: filters,
        sortBy: sortBy,
        sortOrder: sortOrder,
      );
      
      return ProductListModel.fromMagentoResponse(response);
    } catch (e) {
      throw ProductRepositoryException('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: $e');
    }
  }
  
  Future<Product> getProduct(String sku) async {
    try {
      return await _magento.products.getProduct(sku);
    } catch (e) {
      throw ProductRepositoryException('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞: $e');
    }
  }
  
  Future<List<Category>> getCategories() async {
    try {
      return await _magento.products.getCategories();
    } catch (e) {
      throw ProductRepositoryException('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: $e');
    }
  }
  
  Future<List<Product>> searchProducts(String query) async {
    try {
      final response = await _magento.search.searchProducts(
        query,
        page: 1,
        pageSize: 50,
      );
      return response.items;
    } catch (e) {
      throw ProductRepositoryException('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: $e');
    }
  }
}

class ProductRepositoryException implements Exception {
  final String message;
  ProductRepositoryException(this.message);
  
  @override
  String toString() => 'ProductRepositoryException: $message';
}
```

## üé≠ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```dart
// lib/presentation/providers/product_provider.dart
import 'package:flutter/material.dart';
import 'package:flutter_magento/flutter_magento.dart';
import '../../data/repositories/product_repository.dart';
import '../../data/models/product_list_model.dart';

class ProductProvider extends ChangeNotifier {
  final ProductRepository _repository;
  
  ProductProvider(this._repository);
  
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  bool _isLoading = false;
  bool _hasError = false;
  String? _error;
  
  // –î–∞–Ω–Ω—ã–µ
  List<Product> _products = [];
  List<Category> _categories = [];
  ProductListModel? _currentProductList;
  
  // –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  String? _selectedCategoryId;
  String? _searchQuery;
  Map<String, dynamic> _filters = {};
  String _sortBy = 'position';
  String _sortOrder = 'asc';
  
  // –ì–µ—Ç—Ç–µ—Ä—ã
  bool get isLoading => _isLoading;
  bool get hasError => _hasError;
  String? get error => _error;
  List<Product> get products => _products;
  List<Category> get categories => _categories;
  ProductListModel? get currentProductList => _currentProductList;
  String? get selectedCategoryId => _selectedCategoryId;
  String? get searchQuery => _searchQuery;
  Map<String, dynamic> get filters => _filters;
  String get sortBy => _sortBy;
  String get sortOrder => _sortOrder;
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  Future<void> loadProducts({
    int page = 1,
    bool refresh = false,
  }) async {
    if (refresh) {
      _products.clear();
      _currentProductList = null;
    }
    
    _setLoading(true);
    _clearError();
    
    try {
      final productList = await _repository.getProducts(
        page: page,
        pageSize: 20,
        categoryId: _selectedCategoryId,
        searchQuery: _searchQuery,
        filters: _filters,
        sortBy: _sortBy,
        sortOrder: _sortOrder,
      );
      
      if (page == 1) {
        _products = productList.items;
      } else {
        _products.addAll(productList.items);
      }
      
      _currentProductList = productList;
      notifyListeners();
      
    } catch (e) {
      _setError(e.toString());
    } finally {
      _setLoading(false);
    }
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  Future<void> loadCategories() async {
    try {
      _categories = await _repository.getCategories();
      notifyListeners();
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: $e');
    }
  }
  
  // –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  Future<void> searchProducts(String query) async {
    _searchQuery = query;
    _selectedCategoryId = null;
    _filters.clear();
    
    await loadProducts(refresh: true);
  }
  
  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  Future<void> filterByCategory(String? categoryId) async {
    _selectedCategoryId = categoryId;
    _searchQuery = null;
    
    await loadProducts(refresh: true);
  }
  
  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  Future<void> applyFilters(Map<String, dynamic> filters) async {
    _filters = filters;
    await loadProducts(refresh: true);
  }
  
  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  Future<void> setSorting(String sortBy, String sortOrder) async {
    _sortBy = sortBy;
    _sortOrder = sortOrder;
    await loadProducts(refresh: true);
  }
  
  // –û—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  Future<void> clearFilters() async {
    _selectedCategoryId = null;
    _searchQuery = null;
    _filters.clear();
    _sortBy = 'position';
    _sortOrder = 'asc';
    
    await loadProducts(refresh: true);
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  Future<void> loadMoreProducts() async {
    if (_currentProductList != null && 
        _currentProductList!.hasNextPage && 
        !_isLoading) {
      await loadProducts(page: _currentProductList!.currentPage + 1);
    }
  }
  
  // –£—Ç–∏–ª–∏—Ç—ã
  void _setLoading(bool loading) {
    _isLoading = loading;
    notifyListeners();
  }
  
  void _setError(String error) {
    _hasError = true;
    _error = error;
    notifyListeners();
  }
  
  void _clearError() {
    _hasError = false;
    _error = null;
  }
}
```

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã

```dart
// lib/presentation/providers/cart_provider.dart
import 'package:flutter/material.dart';
import 'package:flutter_magento/flutter_magento.dart';
import '../../data/repositories/cart_repository.dart';

class CartProvider extends ChangeNotifier {
  final CartRepository _repository;
  
  CartProvider(this._repository);
  
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  bool _isLoading = false;
  bool _hasError = false;
  String? _error;
  
  // –ö–æ—Ä–∑–∏–Ω–∞
  Cart? _cart;
  List<CartItem> _items = [];
  double _subtotal = 0.0;
  double _total = 0.0;
  int _itemCount = 0;
  
  // –ì–µ—Ç—Ç–µ—Ä—ã
  bool get isLoading => _isLoading;
  bool get hasError => _hasError;
  String? get error => _error;
  Cart? get cart => _cart;
  List<CartItem> get items => _items;
  double get subtotal => _subtotal;
  double get total => _total;
  int get itemCount => _itemCount;
  bool get isEmpty => _items.isEmpty;
  bool get isNotEmpty => _items.isNotEmpty;
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
  Future<void> initializeCart() async {
    _setLoading(true);
    _clearError();
    
    try {
      _cart = await _repository.getOrCreateCart();
      await _loadCartItems();
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã: $e');
    } finally {
      _setLoading(false);
    }
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã
  Future<void> _loadCartItems() async {
    if (_cart == null) return;
    
    try {
      final cartWithItems = await _repository.getCartItems(_cart!.id!);
      _items = cartWithItems.items ?? [];
      _updateTotals();
      notifyListeners();
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã: $e');
    }
  }
  
  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
  Future<bool> addToCart(Product product, {int quantity = 1}) async {
    if (_cart == null) {
      await initializeCart();
    }
    
    _setLoading(true);
    _clearError();
    
    try {
      final updatedCart = await _repository.addToCart(
        cartId: _cart!.id!,
        sku: product.sku,
        quantity: quantity,
      );
      
      _cart = updatedCart;
      await _loadCartItems();
      
      return true;
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É: $e');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
  Future<bool> updateQuantity(String itemId, int quantity) async {
    if (_cart == null) return false;
    
    _setLoading(true);
    _clearError();
    
    try {
      if (quantity <= 0) {
        return await removeFromCart(itemId);
      }
      
      await _repository.updateCartItem(
        cartId: _cart!.id!,
        itemId: itemId,
        quantity: quantity,
      );
      
      await _loadCartItems();
      return true;
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞: $e');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
  Future<bool> removeFromCart(String itemId) async {
    if (_cart == null) return false;
    
    _setLoading(true);
    _clearError();
    
    try {
      await _repository.removeFromCart(
        cartId: _cart!.id!,
        itemId: itemId,
      );
      
      await _loadCartItems();
      return true;
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã: $e');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
  Future<void> clearCart() async {
    if (_cart == null) return;
    
    _setLoading(true);
    _clearError();
    
    try {
      await _repository.clearCart(_cart!.id!);
      _items.clear();
      _updateTotals();
      notifyListeners();
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã: $e');
    } finally {
      _setLoading(false);
    }
  }
  
  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞
  Future<bool> applyCoupon(String couponCode) async {
    if (_cart == null) return false;
    
    _setLoading(true);
    _clearError();
    
    try {
      await _repository.applyCoupon(
        cartId: _cart!.id!,
        couponCode: couponCode,
      );
      
      await _loadCartItems();
      return true;
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫—É–ø–æ–Ω–∞: $e');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // –£–¥–∞–ª–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞
  Future<bool> removeCoupon() async {
    if (_cart == null) return false;
    
    _setLoading(true);
    _clearError();
    
    try {
      await _repository.removeCoupon(_cart!.id!);
      await _loadCartItems();
      return true;
    } catch (e) {
      _setError('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫—É–ø–æ–Ω–∞: $e');
      return false;
    } finally {
      _setLoading(false);
    }
  }
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã
  Future<void> getCartTotals() async {
    if (_cart == null) return;
    
    try {
      final totals = await _repository.getCartTotals(_cart!.id!);
      _subtotal = totals.subtotal ?? 0.0;
      _total = totals.grandTotal ?? 0.0;
      notifyListeners();
    } catch (e) {
      print('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤: $e');
    }
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
  void _updateTotals() {
    _itemCount = _items.fold(0, (sum, item) => sum + item.quantity);
    _subtotal = _items.fold(0.0, (sum, item) => sum + (item.price * item.quantity));
    _total = _subtotal; // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç, –±–µ–∑ –Ω–∞–ª–æ–≥–æ–≤ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏
  }
  
  // –£—Ç–∏–ª–∏—Ç—ã
  void _setLoading(bool loading) {
    _isLoading = loading;
    notifyListeners();
  }
  
  void _setError(String error) {
    _hasError = true;
    _error = error;
    notifyListeners();
  }
  
  void _clearError() {
    _hasError = false;
    _error = null;
  }
}
```

## üì± UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞

```dart
// lib/presentation/widgets/product_card.dart
import 'package:flutter/material.dart';
import 'package:cached_network_image/cached_network_image.dart';
import 'package:flutter_magento/flutter_magento.dart';
import 'package:provider/provider.dart';
import '../providers/cart_provider.dart';
import '../../core/themes/app_colors.dart';

class ProductCard extends StatelessWidget {
  final Product product;
  final VoidCallback? onTap;
  final bool showAddToCart;
  
  const ProductCard({
    super.key,
    required this.product,
    this.onTap,
    this.showAddToCart = true,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 2,
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(12),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
            Expanded(
              child: Container(
                width: double.infinity,
                decoration: BoxDecoration(
                  borderRadius: const BorderRadius.vertical(
                    top: Radius.circular(12),
                  ),
                  color: Colors.grey[100],
                ),
                child: ClipRRect(
                  borderRadius: const BorderRadius.vertical(
                    top: Radius.circular(12),
                  ),
                  child: CachedNetworkImage(
                    imageUrl: _getProductImageUrl(),
                    fit: BoxFit.cover,
                    placeholder: (context, url) => Container(
                      color: Colors.grey[200],
                      child: const Center(
                        child: CircularProgressIndicator(
                          strokeWidth: 2,
                        ),
                      ),
                    ),
                    errorWidget: (context, url, error) => Container(
                      color: Colors.grey[200],
                      child: const Icon(
                        Icons.image_not_supported,
                        size: 48,
                        color: Colors.grey,
                      ),
                    ),
                  ),
                ),
              ),
            ),
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–¥—É–∫—Ç–µ
            Padding(
              padding: const EdgeInsets.all(12),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // –ù–∞–∑–≤–∞–Ω–∏–µ
                  Text(
                    product.name,
                    style: Theme.of(context).textTheme.titleSmall?.copyWith(
                      fontWeight: FontWeight.w600,
                    ),
                    maxLines: 2,
                    overflow: TextOverflow.ellipsis,
                  ),
                  
                  const SizedBox(height: 4),
                  
                  // –¶–µ–Ω–∞
                  Row(
                    children: [
                      if (product.hasSpecialPrice) ...[
                        Text(
                          '\$${product.specialPrice!.toStringAsFixed(2)}',
                          style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            color: AppColors.error,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                        const SizedBox(width: 8),
                        Text(
                          '\$${product.price.toStringAsFixed(2)}',
                          style: Theme.of(context).textTheme.bodySmall?.copyWith(
                            decoration: TextDecoration.lineThrough,
                            color: Colors.grey,
                          ),
                        ),
                      ] else
                        Text(
                          '\$${product.price.toStringAsFixed(2)}',
                          style: Theme.of(context).textTheme.titleMedium?.copyWith(
                            color: AppColors.primary,
                            fontWeight: FontWeight.bold,
                          ),
                        ),
                    ],
                  ),
                  
                  if (product.hasSpecialPrice) ...[
                    const SizedBox(height: 4),
                    Container(
                      padding: const EdgeInsets.symmetric(
                        horizontal: 6,
                        vertical: 2,
                      ),
                      decoration: BoxDecoration(
                        color: AppColors.error,
                        borderRadius: BorderRadius.circular(4),
                      ),
                      child: Text(
                        '-${product.discountPercentage.toInt()}%',
                        style: const TextStyle(
                          color: Colors.white,
                          fontSize: 10,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                    ),
                  ],
                  
                  if (showAddToCart) ...[
                    const SizedBox(height: 8),
                    
                    // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
                    SizedBox(
                      width: double.infinity,
                      child: Consumer<CartProvider>(
                        builder: (context, cart, child) {
                          return ElevatedButton.icon(
                            onPressed: cart.isLoading
                                ? null
                                : () => _addToCart(context, cart),
                            icon: cart.isLoading
                                ? const SizedBox(
                                    width: 16,
                                    height: 16,
                                    child: CircularProgressIndicator(
                                      strokeWidth: 2,
                                      color: Colors.white,
                                    ),
                                  )
                                : const Icon(Icons.add_shopping_cart, size: 16),
                            label: Text(
                              cart.isLoading ? '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...' : '–í –∫–æ—Ä–∑–∏–Ω—É',
                              style: const TextStyle(fontSize: 12),
                            ),
                            style: ElevatedButton.styleFrom(
                              padding: const EdgeInsets.symmetric(vertical: 8),
                              minimumSize: const Size(double.infinity, 32),
                            ),
                          );
                        },
                      ),
                    ),
                  ],
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
  
  String _getProductImageUrl() {
    if (product.mediaGalleryEntries?.isNotEmpty == true) {
      return product.mediaGalleryEntries!.first.file ?? '';
    }
    return '';
  }
  
  void _addToCart(BuildContext context, CartProvider cart) async {
    final success = await cart.addToCart(product);
    
    if (success && context.mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text('${product.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É'),
          backgroundColor: AppColors.success,
          duration: const Duration(seconds: 2),
          action: SnackBarAction(
            label: '–û—Ç–º–µ–Ω–∏—Ç—å',
            textColor: Colors.white,
            onPressed: () {
              // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            },
          ),
        ),
      );
    } else if (cart.hasError && context.mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text(cart.error ?? '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É'),
          backgroundColor: AppColors.error,
        ),
      );
    }
  }
}
```

### –≠–∫—Ä–∞–Ω –∫–∞—Ç–∞–ª–æ–≥–∞

```dart
// lib/presentation/screens/catalog_screen.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import 'package:pull_to_refresh/pull_to_refresh.dart';
import '../providers/product_provider.dart';
import '../widgets/product_card.dart';
import '../widgets/category_filter.dart';
import '../widgets/search_bar.dart';
import '../widgets/sort_bottom_sheet.dart';
import '../../core/themes/app_colors.dart';

class CatalogScreen extends StatefulWidget {
  const CatalogScreen({super.key});

  @override
  State<CatalogScreen> createState() => _CatalogScreenState();
}

class _CatalogScreenState extends State<CatalogScreen> {
  final RefreshController _refreshController = RefreshController(
    initialRefresh: false,
  );
  
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback((_) {
      context.read<ProductProvider>().loadProducts();
      context.read<ProductProvider>().loadCategories();
    });
  }
  
  @override
  void dispose() {
    _refreshController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('–ö–∞—Ç–∞–ª–æ–≥'),
        actions: [
          // –ü–æ–∏—Å–∫
          IconButton(
            icon: const Icon(Icons.search),
            onPressed: () => _showSearch(context),
          ),
          
          // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
          IconButton(
            icon: const Icon(Icons.sort),
            onPressed: () => _showSortOptions(context),
          ),
          
          // –§–∏–ª—å—Ç—Ä—ã
          IconButton(
            icon: const Icon(Icons.filter_list),
            onPressed: () => _showFilters(context),
          ),
        ],
      ),
      
      body: Consumer<ProductProvider>(
        builder: (context, productProvider, child) {
          return Column(
            children: [
              // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
              if (productProvider.categories.isNotEmpty)
                CategoryFilter(
                  categories: productProvider.categories,
                  selectedCategoryId: productProvider.selectedCategoryId,
                  onCategorySelected: (categoryId) {
                    productProvider.filterByCategory(categoryId);
                  },
                ),
              
              // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
              Expanded(
                child: SmartRefresher(
                  controller: _refreshController,
                  enablePullDown: true,
                  enablePullUp: true,
                  onRefresh: () => _onRefresh(productProvider),
                  onLoading: () => _onLoading(productProvider),
                  child: _buildProductGrid(productProvider),
                ),
              ),
            ],
          );
        },
      ),
    );
  }
  
  Widget _buildProductGrid(ProductProvider productProvider) {
    if (productProvider.isLoading && productProvider.products.isEmpty) {
      return const Center(child: CircularProgressIndicator());
    }
    
    if (productProvider.hasError && productProvider.products.isEmpty) {
      return Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(
              Icons.error_outline,
              size: 64,
              color: Colors.grey[400],
            ),
            const SizedBox(height: 16),
            Text(
              productProvider.error ?? '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',
              textAlign: TextAlign.center,
              style: TextStyle(
                color: Colors.grey[600],
                fontSize: 16,
              ),
            ),
            const SizedBox(height: 16),
            ElevatedButton(
              onPressed: () => productProvider.loadProducts(refresh: true),
              child: const Text('–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
            ),
          ],
        ),
      );
    }
    
    if (productProvider.products.isEmpty) {
      return const Center(
        child: Text(
          '–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
          style: TextStyle(fontSize: 16),
        ),
      );
    }
    
    return GridView.builder(
      padding: const EdgeInsets.all(16),
      gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: 2,
        childAspectRatio: 0.7,
        crossAxisSpacing: 16,
        mainAxisSpacing: 16,
      ),
      itemCount: productProvider.products.length,
      itemBuilder: (context, index) {
        final product = productProvider.products[index];
        return ProductCard(
          product: product,
          onTap: () => _openProductDetails(context, product),
        );
      },
    );
  }
  
  void _onRefresh(ProductProvider productProvider) async {
    await productProvider.loadProducts(refresh: true);
    _refreshController.refreshCompleted();
  }
  
  void _onLoading(ProductProvider productProvider) async {
    await productProvider.loadMoreProducts();
    _refreshController.loadComplete();
  }
  
  void _showSearch(BuildContext context) {
    showSearch(
      context: context,
      delegate: ProductSearchDelegate(
        productProvider: context.read<ProductProvider>(),
      ),
    );
  }
  
  void _showSortOptions(BuildContext context) {
    showModalBottomSheet(
      context: context,
      builder: (context) => SortBottomSheet(
        currentSortBy: context.read<ProductProvider>().sortBy,
        currentSortOrder: context.read<ProductProvider>().sortOrder,
        onSortChanged: (sortBy, sortOrder) {
          context.read<ProductProvider>().setSorting(sortBy, sortOrder);
          Navigator.pop(context);
        },
      ),
    );
  }
  
  void _showFilters(BuildContext context) {
    // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Ä–∞–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text('–§–∏–ª—å—Ç—Ä—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')),
    );
  }
  
  void _openProductDetails(BuildContext context, Product product) {
    Navigator.pushNamed(
      context,
      '/product',
      arguments: product,
    );
  }
}
```

## üîç –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```dart
// lib/presentation/widgets/product_search_delegate.dart
import 'package:flutter/material.dart';
import 'package:flutter_magento/flutter_magento.dart';
import '../providers/product_provider.dart';
import 'product_card.dart';

class ProductSearchDelegate extends SearchDelegate<Product?> {
  final ProductProvider productProvider;
  
  ProductSearchDelegate({required this.productProvider});
  
  @override
  String get searchFieldLabel => '–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...';
  
  @override
  List<Widget> buildActions(BuildContext context) {
    return [
      IconButton(
        icon: const Icon(Icons.clear),
        onPressed: () {
          query = '';
          showSuggestions(context);
        },
      ),
    ];
  }
  
  @override
  Widget buildLeading(BuildContext context) {
    return IconButton(
      icon: const Icon(Icons.arrow_back),
      onPressed: () => close(context, null),
    );
  }
  
  @override
  Widget buildResults(BuildContext context) {
    if (query.isEmpty) {
      return const Center(
        child: Text('–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞'),
      );
    }
    
    return FutureBuilder<void>(
      future: productProvider.searchProducts(query),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return const Center(child: CircularProgressIndicator());
        }
        
        if (productProvider.hasError) {
          return Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                const Icon(Icons.error, size: 64, color: Colors.red),
                const SizedBox(height: 16),
                Text(
                  productProvider.error ?? '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞',
                  textAlign: TextAlign.center,
                ),
                const SizedBox(height: 16),
                ElevatedButton(
                  onPressed: () => productProvider.searchProducts(query),
                  child: const Text('–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
                ),
              ],
            ),
          );
        }
        
        if (productProvider.products.isEmpty) {
          return Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                const Icon(Icons.search_off, size: 64, color: Colors.grey),
                const SizedBox(height: 16),
                Text(
                  '–ü–æ –∑–∞–ø—Ä–æ—Å—É "$query" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                  textAlign: TextAlign.center,
                  style: const TextStyle(fontSize: 16),
                ),
              ],
            ),
          );
        }
        
        return GridView.builder(
          padding: const EdgeInsets.all(16),
          gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
            crossAxisCount: 2,
            childAspectRatio: 0.7,
            crossAxisSpacing: 16,
            mainAxisSpacing: 16,
          ),
          itemCount: productProvider.products.length,
          itemBuilder: (context, index) {
            final product = productProvider.products[index];
            return ProductCard(
              product: product,
              onTap: () {
                close(context, product);
                Navigator.pushNamed(
                  context,
                  '/product',
                  arguments: product,
                );
              },
            );
          },
        );
      },
    );
  }
  
  @override
  Widget buildSuggestions(BuildContext context) {
    if (query.isEmpty) {
      return const Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Icon(Icons.search, size: 64, color: Colors.grey),
            SizedBox(height: 16),
            Text(
              '–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
              style: TextStyle(fontSize: 16, color: Colors.grey),
            ),
          ],
        ),
      );
    }
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
    return ListView(
      children: [
        ListTile(
          leading: const Icon(Icons.search),
          title: Text(query),
          onTap: () => showResults(context),
        ),
      ],
    );
  }
}
```

## üõí –≠–∫—Ä–∞–Ω –∫–æ—Ä–∑–∏–Ω—ã

```dart
// lib/presentation/screens/cart_screen.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import '../providers/cart_provider.dart';
import '../providers/auth_provider.dart';
import '../widgets/cart_item_tile.dart';
import '../widgets/cart_totals.dart';
import '../widgets/coupon_input.dart';
import '../../core/themes/app_colors.dart';

class CartScreen extends StatefulWidget {
  const CartScreen({super.key});

  @override
  State<CartScreen> createState() => _CartScreenState();
}

class _CartScreenState extends State<CartScreen> {
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback((_) {
      context.read<CartProvider>().initializeCart();
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('–ö–æ—Ä–∑–∏–Ω–∞'),
        actions: [
          Consumer<CartProvider>(
            builder: (context, cart, child) {
              if (cart.isNotEmpty) {
                return IconButton(
                  icon: const Icon(Icons.delete_sweep),
                  onPressed: () => _showClearCartDialog(context, cart),
                );
              }
              return const SizedBox.shrink();
            },
          ),
        ],
      ),
      
      body: Consumer<CartProvider>(
        builder: (context, cart, child) {
          if (cart.isLoading && cart.isEmpty) {
            return const Center(child: CircularProgressIndicator());
          }
          
          if (cart.hasError && cart.isEmpty) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(
                    Icons.error_outline,
                    size: 64,
                    color: Colors.red,
                  ),
                  const SizedBox(height: 16),
                  Text(
                    cart.error ?? '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',
                    textAlign: TextAlign.center,
                    style: const TextStyle(fontSize: 16),
                  ),
                  const SizedBox(height: 16),
                  ElevatedButton(
                    onPressed: () => cart.initializeCart(),
                    child: const Text('–ü–æ–≤—Ç–æ—Ä–∏—Ç—å'),
                  ),
                ],
              ),
            );
          }
          
          if (cart.isEmpty) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(
                    Icons.shopping_cart_outlined,
                    size: 64,
                    color: Colors.grey[400],
                  ),
                  const SizedBox(height: 16),
                  Text(
                    '–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞',
                    style: TextStyle(
                      fontSize: 20,
                      color: Colors.grey[600],
                    ),
                  ),
                  const SizedBox(height: 8),
                  Text(
                    '–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞',
                    style: TextStyle(
                      fontSize: 16,
                      color: Colors.grey[500],
                    ),
                  ),
                  const SizedBox(height: 24),
                  ElevatedButton(
                    onPressed: () => Navigator.pushNamed(context, '/catalog'),
                    child: const Text('–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º'),
                  ),
                ],
              ),
            );
          }
          
          return Column(
            children: [
              // –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
              Expanded(
                child: ListView.separated(
                  padding: const EdgeInsets.all(16),
                  itemCount: cart.items.length,
                  separatorBuilder: (context, index) => const SizedBox(height: 8),
                  itemBuilder: (context, index) {
                    final item = cart.items[index];
                    return CartItemTile(
                      item: item,
                      onQuantityChanged: (quantity) {
                        cart.updateQuantity(item.id.toString(), quantity);
                      },
                      onRemove: () {
                        cart.removeFromCart(item.id.toString());
                      },
                    );
                  },
                ),
              ),
              
              // –ö—É–ø–æ–Ω
              const CouponInput(),
              
              // –ò—Ç–æ–≥–∏ –∫–æ—Ä–∑–∏–Ω—ã
              CartTotals(
                subtotal: cart.subtotal,
                total: cart.total,
                itemCount: cart.itemCount,
              ),
              
              // –ö–Ω–æ–ø–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
              Container(
                padding: const EdgeInsets.all(16),
                child: SizedBox(
                  width: double.infinity,
                  child: ElevatedButton(
                    onPressed: cart.isEmpty ? null : () => _proceedToCheckout(context),
                    style: ElevatedButton.styleFrom(
                      padding: const EdgeInsets.symmetric(vertical: 16),
                      textStyle: const TextStyle(
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    child: Text(
                      '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ (\$${cart.total.toStringAsFixed(2)})',
                    ),
                  ),
                ),
              ),
            ],
          );
        },
      ),
    );
  }
  
  void _showClearCartDialog(BuildContext context, CartProvider cart) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É'),
        content: const Text('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('–û—Ç–º–µ–Ω–∞'),
          ),
          TextButton(
            onPressed: () {
              cart.clearCart();
              Navigator.pop(context);
            },
            style: TextButton.styleFrom(
              foregroundColor: AppColors.error,
            ),
            child: const Text('–û—á–∏—Å—Ç–∏—Ç—å'),
          ),
        ],
      ),
    );
  }
  
  void _proceedToCheckout(BuildContext context) {
    final authProvider = context.read<AuthProvider>();
    
    if (!authProvider.isAuthenticated) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—Ö–æ–¥–∞
      showDialog(
        context: context,
        builder: (context) => AlertDialog(
          title: const Text('–ù–µ–æ–±—Ö–æ–¥–∏–º –≤—Ö–æ–¥'),
          content: const Text('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç'),
          actions: [
            TextButton(
              onPressed: () => Navigator.pop(context),
              child: const Text('–û—Ç–º–µ–Ω–∞'),
            ),
            ElevatedButton(
              onPressed: () {
                Navigator.pop(context);
                Navigator.pushNamed(context, '/login');
              },
              child: const Text('–í–æ–π—Ç–∏'),
            ),
          ],
        ),
      );
      return;
    }
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞
    Navigator.pushNamed(context, '/checkout');
  }
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —É –≤–∞—Å –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ e-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å:

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- **–ü–æ–∏—Å–∫** —Å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- **–ö–æ—Ä–∑–∏–Ω–∞** —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–æ—Ñ–∏–ª—å** –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞–º–∏
- **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤**
- **–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π**
- **–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º**
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API

### üé® UX/UI
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Material Design
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

### üì± –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –æ—Ç–∑—ã–≤–∞–º–∏
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞

### üåê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- Crash reporting
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **[–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md)** - –í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–≥–∏–Ω–∞
- **[API Reference](../api-reference/overview.md)** - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- **[AR/3D –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](ar-3d-app.md)** - –ü—Ä–∏–º–µ—Ä —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
- **[B2B –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](b2b-app.md)** - –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

---

**–ì–æ—Ç–æ–≤–æ!** –£ –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ e-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Flutter —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Magento. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–∞–ø–∫–µ `examples/basic-ecommerce/`.
